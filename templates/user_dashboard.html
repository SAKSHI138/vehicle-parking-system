{% extends "base.html" %}
{% block title %}User Dashboard{% endblock %}

{% block content %}
<div class="container">
  <h2 class="mb-3">ğŸ‘‹ Welcome {{ full_name }}</h2>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-success">
        {% for message in messages %}
          <div>{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% if current_spot %}
    <div class="alert alert-success">
      âœ… You have already reserved <strong>Spot {{ current_spot.spot_number }}</strong> at <strong>{{ current_lot.name }}</strong>
    </div>
    <form action="{{ url_for('release_spot') }}" method="POST" class="mb-4">
      <button type="submit" class="btn btn-warning">ğŸ”“ Release My Spot</button>
    </form>
  {% endif %}

  <h4 class="mb-3">Available Parking Lots</h4>

  {% for lot in lots %}
    <div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title">{{ lot.name }} â€“ {{ lot.address }}</h5>
    <p>Total: {{ lot.total_spots }}, Available: {{ lot.available_spots }}</p>

    <!-- âœ… Stylish pricing badges -->
    <div class="mb-3">
      <span class="badge bg-primary">
        ğŸ’° â‚¹{{ lot.base_price }} / first {{ lot.base_duration }} hrs
      </span>
      <span class="badge bg-info text-dark">
        â• â‚¹{{ lot.extra_hour_price }} / extra hr
      </span>
    </div>

    {% if current_spot %}
      {% if lot.id == current_lot.id %}
        <span class="badge bg-success">âœ… You have a reservation in this lot</span>
      {% else %}
        <span class="badge bg-secondary">ğŸ”’ You already have a spot in another lot</span>
      {% endif %}
    {% else %}
      {% if lot.available_spots > 0 %}
        <form action="{{ url_for('reserve', lot_id=lot.id) }}" method="post" class="row g-2 align-items-end">
          <div class="col-md-6">
            <label for="vehicle_number_{{ lot.id }}" class="form-label">ğŸš˜ Vehicle Number</label>
            <input
              type="text"
              id="vehicle_number_{{ lot.id }}"
              name="vehicle_number"
              class="form-control"
              required
              placeholder="e.g. MH12AB1234"
              pattern="[A-Z]{2}[0-9]{2}[A-Z]{1,2}[0-9]{4}"
              title="Format: MH12AB1234"
            >
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100">ğŸš— Reserve Spot</button>
          </div>
        </form>
      {% else %}
        <span class="text-danger">âŒ No Spots Available</span>
      {% endif %}
    {% endif %}
  </div>
</div>

  {% endfor %}

  <div class="mt-4">
    <a href="{{ url_for('user_history') }}" class="btn btn-outline-info me-2">ğŸ•“ View Parking History</a>
    <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">ğŸšª Logout</a>
  </div>
</div>
{% endblock %}
